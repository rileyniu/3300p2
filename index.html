<html>
	<head>
		<title> djm453, xz293, hn263 </title>
		<meta charset="utf-8">
		<script src="https://d3js.org/d3.v4.min.js"></script>
		<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/highlight.min.js"></script>
    <link href="https://fonts.googleapis.com/css?family=Rajdhani|Rubik+Mono+One" rel="stylesheet">
		<link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
		<script src="https://code.jquery.com/jquery-1.12.4.js"></script>
		<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
		<style>
            h1 {font-family: 'Rubik Mono One', sans-serif;
                font-size: 24px;
                font-style: normal;
                font-variant: normal;
                font-weight: 200;
                line-height: 26px;
                display: flex;
                justify-content: center;
                position: fixed;
                color: #C1C1C1;

            }
            h2 {font-family: 'Rajdhani', sans-serif;
                font-size: 14px;
                font-style: normal;
                font-variant: normal;
                font-weight: 80;
                line-height: 18px;
                text-align: right;
                padding-top: 15px;
                padding-right: 15px;
                color: #C1C1C1;
            }
            h3 {font-family: 'Rajdhani', sans-serif;
                font-size: 14px;
                font-style: normal;
                font-variant: normal;
                font-weight: 80;
                line-height: 18px;
                text-align: right;
                padding-right: 15px;
                color: #C1C1C1;
            }
            h4 {font-family: 'Rajdhani', sans-serif;
            	font-size: 14px;
            	font-style: normal;
            	font-variant: normal;
            	font-weight: 80;
            	line-height: 18px;
            	text-align: left;
            	padding-left: 35px;
            	color: #8C8C8B;
            }
			body {font-family: 'Rajdhani', sans-serif;
                text-anchor: 'middle';
                dominant-baseline: 'central';
                background: #2B2727;
            }
            .legendSize circle {
                fill: #CE7602;
                opacity: 0.2;
            }
            .legendSize text {
                font-size: 11px;
                fill: #8C8C8B;
            }
            .textstyle1 {
                font-family: 'Rajdhani', sans-serif;
                font-size: 11px;
                font-style: normal;
                fill: #8C8C8B;
            }
            .textstyle2 {
                font-family: 'Rajdhani', sans-serif;
                font-size: 11px;
                font-style: normal;
                fill: #C1C1C1;
            }
            .textstyle3 {
                font-family: 'Rajdhani', sans-serif;
                font-size: 11px;
                font-style: italic;
                fill: #8C8C8B;
            }
            p#footnotes {
                font-family: 'Rajdhani', sans-serif;
                font-size: 12px;
                font-style: normal;
                color: #8C8C8B;
            }
            a {
                text-decoration: none;
                color: #C1C1C1;
            }
						#map {
								margin-top: 0px;
						}
						.ui-draggable, .ui-droppable {
								background-position: top;
						}

						#slider-vertical {
							height:10px;
							width:1000px;
							margin: auto;
							vertical-align: top;
							background-color: rgba(43, 39, 39, 0.5);
							border-style: solid;
							border-color: rgb(188, 188, 188);
							border-width: 2px;
							border-radius: 10px;
						}
		</style>
	</head>

	<body>
		<h1>Refugee Movement through Time</h1>
        <h2>CS 3300 PROJECT 2</h2>
        <h3>Danyal Motiwalla (djm453)
        <br>Riley Niu (hn263)
        <br> Xinyu Cynthia Zhao (xz293)</h3>


<p id=“project1”>
<div id="slider-vertical"></div><br>
<svg height="600" width="1100" id="map"> </svg>

<script>

$( function() {
		$( "#slider-vertical" ).slider({
			classes: {
    "ui-slider": "highlight"
  },
			range: "min",
			animate: "medium",
			min: 1995,
			max: 2017,
			value: 2000,
			slide: function( event, ui ) {
				var fun = function () {$( "#amount" ).val( ui.value );};
				setTimeout(fun, 5);
			}
		})

.each(function() {
  var vals = 22;

  for (var i = 0; i <= vals ; i++) {
      var tick = $('<div class="tick ui-widget-content"></div>').css('position', 'absolute')
			.css('display', 'inline-block')
			.css('left', (i/vals*100-0.1) +  '%')
			.css('top', 100 +  '%')
			.css('width', '2px')
			.css('height', '16px')
			.css('color', 'white');
			$( "#slider-vertical" ).append(tick);
  }

	$( "#slider-vertical" ).append('<br>');

  // Space out values
  for (var i = 1995; i <= 2017; i+=2) {
    var el = $('<label>'+(i)+'</label>').css('position', 'absolute')
		.css('text-align', 'center').css('color', "white")
		.css('left', ((i-1995)/vals*100-1.5)+'%').css("margin-top", "10px");

		$( "#slider-vertical" ).append(el);
  }

});;
	} );
var svg = d3.select(map);

var rawData;
var refugeeData;

d3.queue()
.defer(d3.json, "countryData.json")
.defer(d3.json, "refugeeData.json")
.await(callback);

// d3.json("refugeeData.json", function (error, data) {
function callback (error, rawCountry, rawRefugee) {
	refugeeData = rawRefugee;
    countryData = rawCountry;

    //country representation as circles
	// var countryList = Object.keys(countryStats)

	// countryStats1 = []
	// for (i = 0; i < countryList.length; i++) {
	// 	countryStats1.push({"country": countryList[i], "stats": countryStats[countryList[i]]})
	// }

	var longitudeExtent = d3.extent(countryData, function (d) {
		return d.longitude;
	});

	var longitudeScale = d3.scaleLinear()
		.domain(longitudeExtent)
		.range([50, 1050]);

	var latitudeExtent = d3.extent(countryData, function (d) {
		return d.latitude;
	});

	var latitudeScale = d3.scaleLinear()
		.domain(latitudeExtent)
		.range([550, 50]);

	var populationExtent = d3.extent(countryData, function (d) {
		return d.population;
	});

	var populationScale = d3.scaleSqrt()
		.domain(populationExtent)
		.range([9, 75]);



    // var mouseover = function(d){

    // };

    // var mouseout = function(d) {

    // };


	var circles = svg.append('g')
                .selectAll("circle").data(countryData);
		circles = circles.enter().append("circle")
			.style("fill", "#34CCFF")
			.style("opacity", 0.2)
			.merge(circles)
            // .on("mouseover", mouseover)
            // .on("mouseout", mouseout);

	circles.on("click", function(d) {
        //d3.select(this).attr("opacity", 1);
	   console.log(d);
	});

	circles.attr("cx", function(d) {
		return longitudeScale(d.longitude)
	});

	circles.attr("cy", function(d) {
		return latitudeScale(d.latitude)
	});

	circles.attr("r", function(d) {
		return populationScale(d.population)
	});



    //paths between country nodes, representing refugee flow
    var links = [];
    for (var i = 0; i < refugeeData.length; i++){
       links.push({"year": refugeeData[i].year, "number":refugeeData[i].refugeeNumber, "source": refugeeData[i].originCountry, "target": refugeeData[i].destinationCountry});
    }


    var nodelinks = links.filter(function(link){
        return link.year == 1995 && link.source!= "Various/Unknown" && link.target !="Various/Unknown" &&
                link.number >10000;
      });



    var refugeeNumExtent = d3.extent(nodelinks, function (d) {
        return d.number;
    });

    var refugeeNumScale = d3.scaleSqrt()
        .domain(refugeeNumExtent)
        .range([1, 20]);

    console.log(refugeeNumExtent);
    var color = d3.scaleSqrt()
    .domain(refugeeNumExtent)
    .range(["#f2f0f7","#54278f"]);


    console.log(nodelinks);

    // var nodelinks1 = nodelinks.filter(function(link){
    //     for(var i = 0; i < countryData.length; i++) {
    //         countryData[i].country == link.source || countryStats1[i].country == link.target;
    //     }
    //   });

//console.log(nodelinks1);

    var long = function (d){
        var info = countryData.filter(function(n){return n.country == d;});
        return info[0].longitude;
    }


    var lat = function (d){
        var info = countryData.filter(function(n){return n.country == d;});
        return info[0].latitude;
    }

// Straight paths
    // var edgeSelection = svg.selectAll("line")
    // .data(nodelinks)
    // .enter().append("line")
    // .attr("stroke", "#ddd")
    // .style("fill", "#34CCFF")
    // .style("opacity", 0.2)
    // .attr('x1', function(d) { return longitudeScale(long(d.source)); })
    // .attr('y1', function(d) { return latitudeScale(lat(d.source)); })
    // .attr('x2', function(d) { return longitudeScale(long(d.target)); })
    // .attr('y2', function(d) { return latitudeScale(lat(d.target)); });

//curved lines
    var edgeSelection = svg.selectAll("path")
    .data(nodelinks)
    .enter().append("path")
    .attr("d", function(d) {
        var sx = longitudeScale(long(d.source)),
            sy = latitudeScale(lat(d.source)),
            tx = longitudeScale(long(d.target)),
            ty = latitudeScale(lat(d.target));
        var dx = tx- sx,
            dy = ty - sy,
            dr = Math.sqrt(dx * dx + dy * dy);
        return "M" + sx + "," + sy + "A" + dr + "," + dr + " 0 0,1 " + tx + "," + ty;
     })
    // .attr("stroke", "#756bb1")
    .attr("stroke", function(d) {
        return color(d.number);
    })
    .style("opacity", 0.8)
    .style("fill", "none")
    .style("stroke-width", function(d) {
                return refugeeNumScale(d.number);
            });

}



</script>
</p>

<p id="footnotes">
SOURCES:
<br>Population data was retreived from <a href="https://data.worldbank.org/indicator/SP.POP.TOTL">World Bank World Development Indicators (2016)</a> and <a href="https://esa.un.org/unpd/wpp/DataQuery/">UN Population Division, World Population Prospects (2016)</a>.
<br>Fonts used are <a href="https://fonts.google.com/specimen/Rubik+Mono+One">Rubik Mono One</a> by Hubert and Fischer and <a href="https://fonts.google.com/specimen/Rajdhani">Rajdhani</a> by Indian Type Foundry, from Google Fonts.
</p>
</body>
</html>
